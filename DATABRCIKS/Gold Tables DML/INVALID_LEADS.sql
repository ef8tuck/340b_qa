-- Databricks notebook source

-- T_tracker missing
--CREATE OR REPLACE VIEW psas_di_qat.340b_gold.V_NON_APEXUS_CODING_WITH_APEXUS_LEADS_01 AS 
TRUNCATE table psas_di_qat.340b_gold.T_NON_APEXUS_CODING_WITH_APEXUS_LEADS_01;
INSERT INTO psas_di_qat.340b_gold.T_NON_APEXUS_CODING_WITH_APEXUS_LEADS_01
SELECT DISTINCT MTACLST.CUST_ACCT_ID, MTACLST.CUST_ACCT_NAME, PHAUD.ZX_BLOCK, TRACK.DMEM_SUBMITTED, MTACLST.ACCT_CLASSIFICATION, PHAUD.PVP_CODING, IFF(PVP_PARTICIPATION_FLAG='Y','Y','N') AS PVP_Flag, PHAUD.PVP_ELIGIBILITY_DATE, PHAUD.PVP_EXPIRATION_DATE, PHAUD.PHS_340B_ID, MTACLST.CUST_CHN_ID, PHAUD.CHAIN_NAM, PHAUD.NATIONAL_GRP_CD AS NATL_GROUP, PHAUD.NATIONAL_SUBGRP_CD AS Sub_Group,PHAUD.NATIONAL_SUBGRP_NAME AS SUB_GROUP_NAME, PHAUD.ACTIVATION_DATE, PHAUD.SALES_LSTMTH, PHAUD.SALES_CURMTH, PHAUD.HRSA_START_DATE, PHAUD.HRSA_TERM_DATE, PHAUD.COMMENTS
FROM psas_di_qat.340b_slvr.T_MT_ACCOUNT_LIST AS MTACLST INNER JOIN psas_di_qat.340b_slvr.T_DMEM_LIST  AS  DMLST ON MTACLST.CUST_ACCT_ID =  DMLST.CUST_ACCT_ID INNER JOIN psas_di_qat.340b_slvr.T_PHS_AUDIT AS PHAUD ON MTACLST.CUST_ACCT_ID = PHAUD.CUST_ACCT_ID INNER JOIN psas_di_qat.340b_slvr.T_MT_LEAD_LIST AS MTLELST ON  DMLST.CNTRCT_LEAD_ID = MTLELST.CNTRCT_LEAD_ID INNER JOIN psas_di_qat.340b_slvr.T_LUTL_PHS_LEADS AS LUPHLEAD ON  DMLST.CNTRCT_LEAD_ID = LUPHLEAD.LEAD LEFT JOIN psas_di_qat.340b_slvr.t_tracker AS TRACK ON MTACLST.CUST_ACCT_ID = TRACK.Account
WHERE MTACLST.ACCT_CLASSIFICATION in ('004','005') AND PHAUD.PVP_CODING='N' AND MTACLST.CUST_CHN_ID NOT IN ('147','889','989') AND UPPER(PHAUD.STATUS)='ACTIVE' AND UPPER(LUPHLEAD.Apexus)='YES'
ORDER BY PHAUD.CHAIN_NAM;

-- COMMAND ----------

------02 Q_HRSA_Termed_with_Apexus_Leads
TRUNCATE table psas_di_qat.340b_gold.T_HRSA_TERMED_WITH_APEXUS_LEADS_02;
INSERT INTO psas_di_qat.340b_gold.T_HRSA_TERMED_WITH_APEXUS_LEADS_02
SELECT DISTINCT MTACLST.CUST_ACCT_ID, MTACLST.CUST_ACCT_NAME, PHAUD.PHS_340B_ID, MTACLST.CUST_CHN_ID, PHAUD.CHAIN_NAM, PHAUD.NATIONAL_GRP_CD AS NATL_GROUP, PHAUD.NATIONAL_SUBGRP_CD AS SUB_GROUP, PHAUD.NATIONAL_SUBGRP_NAME AS SUB_GROUP_NAME, PHAUD.SALES_LSTMTH, PHAUD.SALES_CURMTH, PHAUD.HRSA_START_DATE, PHAUD.HRSA_TERM_DATE, PHAUD.ZX_BLOCK, PHAUD.COMMENTS
FROM psas_di_qat.340b_slvr.T_MT_ACCOUNT_LIST AS MTACLST INNER JOIN psas_di_qat.340b_slvr.T_DMEM_LIST AS  DMLST ON MTACLST.CUST_ACCT_ID =  DMLST.CUST_ACCT_ID INNER JOIN psas_di_qat.340b_slvr.T_PHS_AUDIT AS PHAUD ON MTACLST.CUST_ACCT_ID = PHAUD.CUST_ACCT_ID INNER JOIN psas_di_qat.340b_slvr.T_MT_LEAD_LIST AS MTLELST ON  DMLST.CNTRCT_LEAD_ID = MTLELST.CNTRCT_LEAD_ID INNER JOIN psas_di_qat.340b_slvr.T_LUTL_PHS_LEADS AS LUPHLEAD ON  DMLST.CNTRCT_LEAD_ID = LUPHLEAD.LEAD
WHERE MTACLST.CUST_CHN_ID NOT IN ('147','889','989') AND PHAUD.HRSA_TERM_DATE < CURRENT_DATE() AND MTACLST.ACCT_CLASSIFICATION in ('004','005') AND UPPER(PHAUD.STATUS)='ACTIVE' AND UPPER(LUPHLEAD.Apexus)='YES'
ORDER BY PHAUD.PHS_340B_ID;

CREATE OR REPLACE VIEW  psas_di_qat.340b_gold.V_HRSA_TERMED_WITH_APEXUS_LEADS_02 AS SELECT * FROM psas_di_qat.340b_gold.T_HRSA_TERMED_WITH_APEXUS_LEADS_02;

-- COMMAND ----------

------03 Q_Override_Leads
------MT_OVERRIDE_LEAD_LIST Source need to be identified 
--INSERT INTO MT_OVERRIDE_LEAD_LIST_TEMP(CNTRCT_LEAD_ID,LEAD_NAME) values(371688,'');
--INSERT INTO MT_OVERRIDE_LEAD_LIST_TEMP(CNTRCT_LEAD_ID,LEAD_NAME) values(374328,'');	
--INSERT INTO MT_OVERRIDE_LEAD_LIST_TEMP(CNTRCT_LEAD_ID,LEAD_NAME) values(596370,'');	
--INSERT INTO MT_OVERRIDE_LEAD_LIST_TEMP(CNTRCT_LEAD_ID,LEAD_NAME) values(596587,'');	
--INSERT INTO MT_OVERRIDE_LEAD_LIST_TEMP(CNTRCT_LEAD_ID,LEAD_NAME) values(813777,'');	
--INSERT INTO MT_OVERRIDE_LEAD_LIST_TEMP(CNTRCT_LEAD_ID,LEAD_NAME) values(982534,'');	
--INSERT INTO MT_OVERRIDE_LEAD_LIST_TEMP(CNTRCT_LEAD_ID,LEAD_NAME) values(540881,'');	
--INSERT INTO MT_OVERRIDE_LEAD_LIST_TEMP(CNTRCT_LEAD_ID,LEAD_NAME) values(138205,'');	
--INSERT INTO MT_OVERRIDE_LEAD_LIST_TEMP(CNTRCT_LEAD_ID,LEAD_NAME) values(040341,'MULTISOURCE PREMIER');
--INSERT INTO MT_OVERRIDE_LEAD_LIST_TEMP(CNTRCT_LEAD_ID,LEAD_NAME) values(090542,'HSNA74 RX PAK');
--INSERT INTO MT_OVERRIDE_LEAD_LIST_TEMP(CNTRCT_LEAD_ID,LEAD_NAME) values(090544,'HSNA74 L-IV');         
--INSERT INTO MT_OVERRIDE_LEAD_LIST_TEMP(CNTRCT_LEAD_ID,LEAD_NAME) values(090540,'HSNA74 OTC+');
--INSERT INTO MT_OVERRIDE_LEAD_LIST_TEMP(CNTRCT_LEAD_ID,LEAD_NAME) values(040449,'NWN PREMIER LEAD');
--INSERT INTO MT_OVERRIDE_LEAD_LIST_TEMP(CNTRCT_LEAD_ID,LEAD_NAME) values(583744,'');
--INSERT INTO MT_OVERRIDE_LEAD_LIST_TEMP(CNTRCT_LEAD_ID,LEAD_NAME) values(621158,'');	


-- COMMAND ----------

TRUNCATE table psas_di_qat.340b_gold.T_OVERRIDE_LEADS_03;
INSERT INTO psas_di_qat.340b_gold.T_OVERRIDE_LEADS_03 
SELECT DISTINCT DMLST.CUST_ACCT_ID, PHAUD.CUST_ACCT_NAME, DMLST.CNTRCT_LEAD_ID, MTLELST.CNTRCT_LEAD_NAME, PHAUD.STATUS, PHAUD.CUST_CHN_ID, PHAUD.COMMENTS
FROM psas_di_qat.340b_slvr.T_MT_OVERRIDE_LEAD_LIST AS MTOVLELST INNER JOIN psas_di_qat.340b_slvr.T_DMEM_LIST AS DMLST ON MTOVLELST.CNTRCT_LEAD_ID = DMLST.CNTRCT_LEAD_ID INNER JOIN psas_di_qat.340b_slvr.T_PHS_AUDIT AS PHAUD ON DMLST.CUST_ACCT_ID = PHAUD.CUST_ACCT_ID LEFT JOIN psas_di_qat.340b_slvr.T_MT_LEAD_LIST AS MTLELST ON MTOVLELST.CNTRCT_LEAD_ID = MTLELST.CNTRCT_LEAD_ID
WHERE UPPER(PHAUD.STATUS)='ACTIVE' AND PHAUD.CUST_CHN_ID IN ('147','586','889')
ORDER BY PHAUD.CUST_ACCT_NAME;

CREATE OR REPLACE VIEW  psas_di_qat.340b_gold.V_OVERRIDE_LEADS_03 AS SELECT * FROM psas_di_qat.340b_gold.T_OVERRIDE_LEADS_03;


-- COMMAND ----------

----------04 Q_C34_Apexus_Leads
TRUNCATE table psas_di_qat.340b_gold.T_C34_APEXUS_LEADS_04;
INSERT INTO psas_di_qat.340b_gold.T_C34_APEXUS_LEADS_04  
SELECT PHAUD.CUST_ACCT_ID, PHAUD.CUST_ACCT_NAME, DMLST.CNTRCT_LEAD_ID, PHAUD.MNC
FROM psas_di_qat.340b_gold.t_phs_audit_2 AS PHAUD INNER JOIN psas_di_qat.340b_slvr.T_DMEM_LIST AS DMLST ON PHAUD.CUST_ACCT_ID = DMLST.CUST_ACCT_ID INNER JOIN psas_di_qat.340b_slvr.T_LUTL_PHS_LEADS AS LUPHLEAD ON DMLST.CNTRCT_LEAD_ID = LUPHLEAD.LEAD
WHERE PHAUD.MNC='C34' AND PHAUD.CUST_CHN_ID != '989' AND UPPER(PHAUD.STATUS)='ACTIVE';

CREATE OR REPLACE VIEW  psas_di_qat.340b_gold.V_C34_APEXUS_LEADS_04 AS SELECT * FROM psas_di_qat.340b_gold.T_C34_APEXUS_LEADS_04;

-- COMMAND ----------

------------------------------- 05a Q_Apexus_McK_Programs
TRUNCATE table psas_di_qat.340b_gold.T_APEXUS_MCK_PROGRAMS_05A;
INSERT INTO psas_di_qat.340b_gold.T_APEXUS_MCK_PROGRAMS_05A 
SELECT DISTINCT PHAUD.CUST_ACCT_ID, PHAUD.CUST_ACCT_NAME, PHAUD.SALES_CURMTH, PHAUD.ACCT_CLASSIFICATION AS Acct_Class, PHAUD.NATIONAL_GRP_CD AS NATL_GRP, PHAUD.CUST_CHN_ID AS Chain, PHAUD.CHAIN_NAM, PHAUD.ACTIVATION_DATE, PHAUD.PVP_PARTICIPATION_FLAG AS PVP_Flag, MTLELST.CNTRCT_LEAD_ID AS Lead, MTLELST.CNTRCT_LEAD_NAME, DMLST.PRTY_CONT, MTLELST.CNTRCT_LEAD_TYPE
FROM psas_di_qat.340b_slvr.T_DMEM_LIST AS DMLST INNER JOIN psas_di_qat.340b_gold.t_phs_audit_2 AS PHAUD ON DMLST.CUST_ACCT_ID = PHAUD.CUST_ACCT_ID INNER JOIN psas_di_qat.340b_slvr.T_MT_Lead_List AS MTLELST ON DMLST.CNTRCT_LEAD_ID = MTLELST.CNTRCT_LEAD_ID
WHERE ((PHAUD.ACCT_CLASSIFICATION in ('004','005')) AND (PHAUD.CUST_CHN_ID != '989') AND (MTLELST.CNTRCT_LEAD_TYPE In ('ONE','NET','MCK','ONE','MUL')) AND (UPPER(PHAUD.STATUS)='ACTIVE')) OR ((MTLELST.CNTRCT_LEAD_ID='610747' OR MTLELST.CNTRCT_LEAD_ID='631047') AND (MTLELST.CNTRCT_LEAD_TYPE='IND') AND (UPPER(PHAUD.STATUS)='ACTIVE'))
ORDER BY PHAUD.CHAIN_NAM, PHAUD.CUST_ACCT_NAME;

-- COMMAND ----------

-- Note: There are some insert statements in the file.

-- COMMAND ----------

TRUNCATE table psas_di_qat.340b_gold.T_APEXUS_MCK_PROGRAMS_05B;
INSERT INTO psas_di_qat.340b_gold.T_APEXUS_MCK_PROGRAMS_05B
SELECT APMCKPR05A.CUST_ACCT_ID AS Account, APMCKPR05A.CUST_ACCT_NAME, APMCKPR05A.SALES_CURMTH, APMCKPR05A.Acct_Class, APMCKPR05A.Natl_Grp, APMCKPR05A.Chain, APMCKPR05A.CHAIN_NAM, APMCKPR05A.ACTIVATION_DATE, APMCKPR05A.Lead, APMCKPR05A.CNTRCT_LEAD_NAME AS Lead_Name, MTLEINLST.Comments, APMCKPR05A.CNTRCT_LEAD_TYPE AS Type
FROM psas_di_qat.340b_gold.T_APEXUS_MCK_PROGRAMS_05A AS APMCKPR05A LEFT JOIN psas_di_qat.340b_slvr.T_MT_LEAD_INELIGIBLE_LIST AS MTLEINLST ON APMCKPR05A.Lead = MTLEINLST.Lead
WHERE ((APMCKPR05A.Acct_Class in ('004','005')) AND (APMCKPR05A.Natl_Grp='0230' And APMCKPR05A.Natl_Grp !='0508') AND (UPPER(APMCKPR05A.CNTRCT_LEAD_NAME) Not IN ('NWN PREMIER LEAD','NWN MARSHFIELD','MULTISOURCE PREMIER','HSNA74 MS','HSNA74 NWN')) AND (UPPER(CONCAT_WS(LEFT(CNTRCT_LEAD_NAME,3), PRTY_CONT)) Not In ('FLU99')) AND (CHARINDEX('NBOR',CNTRCT_LEAD_NAME)=0)) OR ((APMCKPR05A.Acct_Class in ('004','005')) AND (UPPER(APMCKPR05A.NATL_GRP) Not In ('0230','0508')) AND (CONCAT_WS(LEFT(CNTRCT_LEAD_NAME,3), PRTY_CONT) Not In ('FLU99')))
ORDER BY APMCKPR05A.Acct_Class, APMCKPR05A.CNTRCT_LEAD_NAME;

CREATE OR REPLACE TABLE  psas_di_qat.340b_gold.V_APEXUS_MCK_PROGRAMS_05B AS SELECT * FROM psas_di_qat.340b_gold.T_APEXUS_MCK_PROGRAMS_05B;


-- COMMAND ----------

TRUNCATE TABLE psas_di_qat.340b_gold.T_APEXUS_MCK_PROGRAMS_SUMMARY_05C;
INSERT INTO psas_di_qat.340b_gold.T_APEXUS_MCK_PROGRAMS_SUMMARY_05C
SELECT APMCKPR05B.Lead, APMCKPR05B.Lead_Name, Count(APMCKPR05B.Account) AS CountOfAccount
FROM  psas_di_qat.340b_gold.T_APEXUS_MCK_PROGRAMS_05B AS APMCKPR05B 
GROUP BY APMCKPR05B.Lead, APMCKPR05B.Lead_Name;

CREATE OR REPLACE VIEW psas_di_qat.340b_gold.V_APEXUS_MCK_PROGRAMS_SUMMARY_05C AS SELECT * FROM psas_di_qat.340b_gold.T_APEXUS_MCK_PROGRAMS_SUMMARY_05C;


-- COMMAND ----------

--tablrs not found so not executed
TRUNCATE TABLE psas_di_qat.340b_gold.T_APEXUS_MCK_PROGRAMS_06;
INSERT INTO psas_di_qat.340b_gold.T_APEXUS_MCK_PROGRAMS_06
SELECT E.CUST_ACCT_ID, CA.CUST_ACCT_NAM, V.XFD_KU_340B_ID,
V.MCK_KU_ACCT_CLAS AS Acct_Class, CA.NATL_GRP_CD, CA.ACCT_CHN_ID,
L.CNTRC_LEAD_TP_ID AS LEAD_ID, L.LEAD_NAME, L.LEAD_TYPE, L.LST_UPDT_DT
FROM psas_di_qat.340b_brnz.t_dcon_cont_elig AS E INNER JOIN psas_di_qat.340b_brnz.t_dm_vstx_cust AS V
ON E.CUST_ACCT_ID = V.CUST_ACCT_ID
INNER JOIN psas_di_qat.340b_brnz.t_cms_lead AS L ON E.CNTRCT_LEAD_ID = L.CNTRC_LEAD_ID
INNER JOIN psas_di_qat.340b_brnz.t_iw_cust_acct AS CA
ON E.CUST_ACCT_ID = CA.CUST_ACCT_ID
WHERE V.MCK_KU_ACCT_CLAS IN ('003','004','005') AND CA.ACCT_CHN_ID NOT IN ('000','989') AND CA.ACTIVE_CUST_IND = 'A'
AND SUBSTRING(V.XFD_KU_340B_ID,1,3) <> '000' AND V.XFD_KU_340B_ID IS NOT NULL
AND ((CA.NATL_GRP_CD = '0230' AND L.CNTRC_LEAD_TP_ID NOT IN ('40341','40449')) OR (CA.NATL_GRP_CD <> '0230'))
AND L.CNTRC_LEAD_TP_ID NOT IN -- EXCLUDE
('40019','94139','113705','125712','293388','452279','526528','869967')
AND L.CNTRC_LEAD_TP_ID IN -- INCLUDE
('1359', '2965', '4360', '9097', '9098', '9102', '9466', '9518', '9679', '9766', '9826', '9840', '9925', '10143', '10144', '10246', '10261', '10262', '10263', '10323', '10433', '12953', '13597', '13758', '13919', '16690', '19911', '20013', '20015', '20992', '25561', '26921', '28262', '31623', '32903', '32927', '32930', '32931', '32932', '32935', '33032', '33045', '33057', '33579', '33847', '34570', '36588', '38854', '39805', '39858', '39912', '40019', '40127', '40180', '40341', '40449', '40663', '42140', '42141', '42142', '42185', '42186', '42188', '42191', '42244', '42245', '42248', '42249', '42250', '43101', '43161', '43162', '43212', '43215', '43425', '44666', '47615', '49639', '55636', '55674', '56052', '72978', '78142', '78258', '88951', '90260', '90261', '90262', '90263', '90264', '90265','90390', '91048', '91636', '91639', '91641', '91642', '91791', '91792', '91903', '92517', '92562', '92566', '92602', '92933', '93015', '93016', '93057', '93082', '93102', '93402', '93491', '93493', '93668', '93730', '94206', '94218', '94330', '94757', '95128', '95416', '96734', '97250', '97359', '100061', '100142', '104258', '107118', '108133', '109537', '113277', '117844', '117997', '118910', '118989', '119301', '119505', '119506','119547', '119778', '119779', '122965', '123034', '123042', '123044', '123067', '123702', '124147', '124740', '124757', '125712', '128027', '130090', '130552', '131287', '137798', '141989', '142105', '148816', '153522', '153523', '153538', '153582', '153709', '154059', '154094', '154232', '154360', '154454', '154455', '155410', '155469', '155841', '155842', '155843', '155844', '155845', '155857', '156023', '156088', '156132', '156178', '156340', '156370', '156594', '156634', '156767', '156868', '156871', '156967', '157191', '157195', '162884', '168296', '171464', '171580', '175861', '181352', '182845', '185613', '186018', '186335', '194770', '196958', '203833', '206496', '206786', '208709', '208783', '213449', '215382', '219062', '220730', '222451', '224280', '224876', '225204', '233294', '233374', '234169', '235236', '235935', '239682', '240546', '241306', '243596', '243919', '244149', '250265', '253084', '253258', '253530', '253562', '259441', '261001', '268757', '281572', '291082', '291858', '295570', '301116', '301385', '302052', '303159', '304181', '305097', '309032', '309399', '312247', '314976', '316590', '316780', '316862', '316969', '316970', '317055', '317193', '317216', '320355', '322713', '330965', '333587', '339809', '341612', '343314', '343518', '351830', '352024', '352268', '352501', '352646', '352665', '352754', '352806', '352908', '352956', '352973', '353038', '353067', '353070', '353089', '353098', '353099', '353101', '353179', '353461', '353463', '353501', '353550', '353646', '353883', '353899', '353900', '353901', '353902', '353932', '353933', '354034', '354079', '354088', '354130', '354145', '354313', '354401', '354404', '354624', '354652', '354707', '354820', '354897', '355150', '355153', '355154', '355155', '355232', '357432', '360183', '360932', '362507', '363685', '363775', '363786', '363894', '363901', '363902', '363904', '363905', '363907', '363976', '364025', '364136', '364822', '365248', '365340', '365378', '365447', '365449', '365450', '365453', '365918', '365995', '365996', '366647', '366839', '366844', '366845', '366862', '366919', '367329', '368052', '368053', '368347', '368349', '368452', '368513', '368575', '369001', '369024', '369026', '369029', '369037', '369142', '369745', '369811', '370094', '370196', '370201', '370274', '370414', '370415', '370978', '370979', '371055', '371306', '372082', '372865', '372963', '372965', '373375', '373410', '374346', '375265', '375445', '375690', '375798', '375813', '375819', '376025', '376027', '376029', '376031', '376039', '376060', '376290','376291', '376294', '376295', '376296', '376981', '379345', '382506', '383415', '384368', '388719', '390421', '391026', '391596', '391632', '395722', '396282', '400339', '400348', '402485', '402840', '402922', '403400', '403533', '403843', '405520', '410901', '410904', '410905', '410906', '410907', '410908', '410973', '410979', '410983', '410992', '411344', '411426', '411882', '411886', '411889', '411891', '411894', '411925', '412654', '412806', '412813', '413291', '413292', '420053', '420194', '420504', '420509', '423538', '425379', '431184', '431470', '432417', '434184', '434492', '435633', '435955', '439819', '443724', '450016', '450597', '450844', '452088', '452279', '452314', '452597', '452731', '452733', '452743', '452900', '452931', '452947', '452948', '452949', '452950', '452951', '452955', '452956', '453168', '453406', '453410', '453502', '453505', '453552', '453592', '454067', '454091', '454297', '454410', '454540', '454672', '454776', '454789', '454799', '454804', '454807', '454977', '455206', '455272', '456088', '457539', '462097', '464260', '464923', '465379', '465995', '466631', '466680', '471810', '472457', '473150', '474121', '474174', '474335', '475143', '475728', '478569', '480185', '482225', '487962', '488008', '488009', '488035', '488040', '488485', '488613', '488972', '489097', '489099', '489100', '489124', '489275', '489339', '489380', '489387', '489485', '489487', '489494', '489635', '489638', '489642', '489667', '489688', '489720', '490023', '490034', '490282', '491847', '496220', '496325', '496469', '496686', '496781', '496795', '499712', '501272', '502113', '502147', '504926', '505607', '506133', '507449', '507932', '508254', '509055', '509295', '512961', '513387', '514235', '515386', '516508', '516623', '516893', '516940', '517860', '518554', '520219', '523059', '523544', '523862', '525429', '526310', '526311', '526347', '526528', '526547', '526898', '527307', '527313', '527314', '527870', '534003', '535362', '535980', '538898', '538944', '539006', '539419', '540206', '540491', '541045', '543709', '543991', '546698', '546952', '551508', '552725', '554317', '555695', '556003', '556004', '556005', '556226', '556467', '556642', '556643', '556695', '556700', '556886', '556917', '557024', '557030', '557031', '557487', '557531', '557620', '557623', '557648', '557649', '557701', '557725', '557747', '558456', '559505', '561361', '561867', '564002', '564862', '573727', '574115', '574484', '575237', '576183', '576284', '577318', '577949', '578398', '581224', '581903', '581906', '586439', '587037','587058', '587340', '587765', '588003', '588050', '588199', '588201', '588203', '588364', '588739', '588792', '588967', '589012', '589057', '589400', '589605', '589717', '591330', '591331', '591371', '591372', '592134', '592672', '592823', '592829', '595289', '597603', '598825', '611655', '612567', '613847', '613897', '614026', '614766', '615685', '616529', '616768', '617716', '617839', '618153', '618594', '619016', '621208', '621218', '621260', '621263', '621327', '621481', '621483', '621492', '622379', '622437', '622544', '622617', '622817', '623032', '623263', '624217', '626094', '626097', '626098', '630771', '634619', '634665', '637591', '637632', '638054', '638631', '639129', '641329', '641805', '641822', '642027', '643774', '644045', '646457', '646546', '647029', '648551', '654948', '656078', '656904', '660436', '661297', '663276', '666019', '667841', '667843', '675677', '680153', '680549', '682467', '683992', '684187', '688129', '688132', '688257', '688719', '689751', '689764', '689846', '689979', '690571', '694405', '698466', '699519', '699589', '699608', '699836', '699985', '700977', '701031', '702158', '702265', '702319', '702426', '702587', '702641', '702748', '702802', '702909', '703070', '703392', '703446', '706344', '710440', '713419', '713422', '713423', '713426', '713467', '713468', '713470', '713473', '713474', '713476', '713478', '713524', '713530', '713534', '713535', '713577', '713578', '713579', '713580', '713581', '713582', '713583', '713960', '713984', '714606', '714607', '714656', '714661', '714662', '714716', '717505', '717812', '718352', '718466', '719158', '724747', '725548', '726782', '727127', '727229', '732796', '733445', '734729', '734785', '735503', '738660', '740812', '744737', '750895', '751539', '758257', '758921', '760277', '760655', '760815', '765593', '766070', '766481', '772476', '774912', '774917', '775664', '780928', '781306', '785477', '786200', '786735', '787729', '787823', '789741', '800145', '800455', '800957', '801058', '801070', '801172', '801299', '801925', '802072', '802135', '804465', '804604', '810132', '815810', '817160', '817911', '818370', '820800', '821368', '822708', '822886', '824412', '825613', '825667', '828989', '830207', '834121', '838470', '839429', '842814', '853793', '854635', '855806', '855898', '855960', '857117', '858311', '864917', '866405', '867106', '870506', '870635', '873534', '876793', '876943', '878336', '878432', '879844', '884111', '889565', '889645', '890240', '898962', '901323', '901696', '902179', '904890', '904948', '908995', '910765','910846', '913057', '913122', '916516', '917350', '917566', '918171', '918729', '920899', '922060', '924970', '932689', '936032', '936159', '941555', '941784', '945441', '946176', '947876', '948381', '949603', '957144', '962371', '964004', '964645', '964677', '968159', '968413', '968452', '972716', '975191', '975194', '975222', '976488', '977806', '977914', '979695', '981777', '989650', '991294');



-- COMMAND ----------

CREATE OR REPLACE VIEW  psas_di_qat.340b_gold.V_APEXUS_MCK_PROGRAMS_06 AS SELECT * FROM  psas_di_qat.340b_gold.T_APEXUS_MCK_PROGRAMS_06;

-- COMMAND ----------

TRUNCATE TABLE psas_di_qat.340b_gold.T_PHS_LEADS_07;
INSERT INTO psas_di_qat.340b_gold.T_PHS_LEADS_07
SELECT PHAUD.CUST_ACCT_ID, PHAUD.CUST_ACCT_NAME, LUPHLEAD.LEAD, LUPHLEAD.LEAD_NAME, PHAUD.PHS_340B_ID, LUPHLEAD.Expansion AS Expansion_Lead, CASE
    WHEN ENTITY_TYPE='RRC' THEN 'Y'
	WHEN ENTITY_TYPE='SCH' THEN 'Y'
	WHEN ENTITY_TYPE='CAN' THEN 'Y'
	WHEN ENTITY_TYPE='CAH' THEN 'Y'
	ELSE 'N'
END AS Expansion_Account 
FROM (psas_di_qat.340b_slvr.T_DMEM_List AS DMLST INNER JOIN psas_di_qat.340b_gold.t_phs_audit_2 AS PHAUD ON DMLST.CUST_ACCT_ID = PHAUD.CUST_ACCT_ID) INNER JOIN psas_di_qat.340b_slvr.T_LUTL_PHS_LEADS AS LUPHLEAD ON DMLST.CNTRCT_LEAD_ID = LUPHLEAD.LEAD
WHERE (((LUPHLEAD.Expansion)='N') AND (CASE
    WHEN ENTITY_TYPE='RRC' THEN 'Y'
	WHEN ENTITY_TYPE='SCH' THEN 'Y'
	WHEN ENTITY_TYPE='CAN' THEN 'Y'
	WHEN ENTITY_TYPE='CAH' THEN 'Y'
	ELSE 'N'
END ='Y') AND (PHAUD.ACCT_CLASSIFICATION in ('004','005')) AND (UPPER(LUPHLEAD.Apexus)='NO') AND (UPPER(PHAUD.STATUS)='ACTIVE')) OR ((LUPHLEAD.Expansion='Y') AND ((CASE
    WHEN ENTITY_TYPE='RRC' THEN 'Y'
	WHEN ENTITY_TYPE='SCH' THEN 'Y'
	WHEN ENTITY_TYPE='CAN' THEN 'Y'
	WHEN ENTITY_TYPE='CAH' THEN 'Y'
	ELSE 'N'
END)='N'))
ORDER BY PHAUD.CUST_ACCT_ID;

 CREATE OR REPLACE VIEW  psas_di_qat.340b_gold.V_PHS_LEADS_07 AS SELECT * FROM psas_di_qat.340b_gold.T_PHS_LEADS_07;
